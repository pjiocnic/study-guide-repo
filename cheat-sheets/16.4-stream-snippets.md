
1. TourManager

```java
public class TourManager {
    private final TreeSet<TTourPackage> vacations;

    public TourManager() {
        this.vacations = new TreeSet<>(Comparator.comparing(TTourPackage::getOfferDate));
    }

    public void addPackage(TTourPackage newPackage) {
        // Check if there's an existing active package with the same vacation name
        Optional<TTourPackage> existingPackage = findActivePackageByName(newPackage.getVacationName());

        if (existingPackage.isPresent()) {
            TTourPackage existing = existingPackage.get();

            // If the existing package has a newer offer date, terminate the new package
            if (existing.getOfferDate().isAfter(newPackage.getOfferDate())) {
                newPackage.setTerminationDate(LocalDate.now());
                vacations.add(newPackage);  // Add the terminated package to the collection
                return;  // No further action needed
            }

            // If the existing package has an older or same offer date, terminate the existing one
            if (existing.getOperators().equals(newPackage.getOperators())) {
                existing.setTerminationDate(LocalDate.now());
            }
        }

        // Handle the scenario for Operator B replacing Operator A
        if (newPackage.getOperators().contains(TourOperator.OPERATOR_B)) {
            terminatePackagesFromOperator(TourOperator.OPERATOR_A);
        }

        // Handle new packages from Operator A when Operator B is active
        if (newPackage.getOperators().contains(TourOperator.OPERATOR_A)) {
            Optional<TTourPackage> activePackageB = findActivePackageByOperator(Collections.singleton(TourOperator.OPERATOR_B));
            if (activePackageB.isPresent() && !activePackageB.get().getVacationName().equals(newPackage.getVacationName())) {
                newPackage.setTerminationDate(LocalDate.now());
                vacations.add(newPackage);  // Add the terminated package to the collection
                return;
            }
        }

        // Terminate older packages from the same operator
        terminatePackagesFromSameOperator(newPackage);

        // Add the new package to the collection
        vacations.add(newPackage);
    }

    private Optional<TTourPackage> findActivePackageByName(String vacationName) {
        return vacations.stream()
                .filter(pkg -> pkg.getVacationName().equals(vacationName) && pkg.getTerminationDate() == null)
                .findFirst();
    }

    private Optional<TTourPackage> findActivePackageByOperator(Set<TourOperator> operators) {
        return vacations.stream()
                .filter(pkg -> pkg.getOperators().containsAll(operators) && pkg.getTerminationDate() == null)
                .findFirst();
    }

    private void terminatePackagesFromOperator(TourOperator operator) {
        vacations.stream()
                .filter(pkg -> pkg.getOperators().contains(operator) && pkg.getTerminationDate() == null)
                .forEach(pkg -> pkg.setTerminationDate(LocalDate.now()));
    }

    private void terminatePackagesFromSameOperator(TTourPackage newPackage) {
        vacations.stream()
                .filter(pkg -> pkg.getOperators().containsAll(newPackage.getOperators()) && pkg.getTerminationDate() == null)
                .forEach(pkg -> pkg.setTerminationDate(LocalDate.now()));
    }

    public TreeSet<TTourPackage> getVacations() {
        return vacations;
    }
}
```

2. TourPackage

```java
public class TTourPackage {
    private String vacationName;
    private LocalDate offerDate;
    private LocalDate terminationDate;  // Can be null if the package is active
    private Set<TourOperator> operators;  // A set of operators offering this package

    public TTourPackage(String vacationName, LocalDate offerDate, TourOperator operator) {
        this.vacationName = vacationName;
        this.offerDate = offerDate;
        this.terminationDate = null;  // Initially, the package is active (not terminated)
        this.operators = EnumSet.of(operator);  // Add the initial operator to the set
    }

    // Getters
    public String getVacationName() {
        return vacationName;
    }

    public LocalDate getOfferDate() {
        return offerDate;
    }

    public LocalDate getTerminationDate() {
        return terminationDate;
    }

    public Set<TourOperator> getOperators() {
        return operators;
    }

    // Setters
    public void setTerminationDate(LocalDate terminationDate) {
        this.terminationDate = terminationDate;
    }

    // Utility method to add more operators
    public void addOperators(Set<TourOperator> newOperators) {
        this.operators.addAll(newOperators);
    }

    // equals and hashCode based on vacation name and offer date, ensuring uniqueness
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof TTourPackage)) return false;
        TTourPackage that = (TTourPackage) o;
        return vacationName.equals(that.vacationName) && offerDate.equals(that.offerDate);
    }

    @Override
    public int hashCode() {
        return Objects.hash(vacationName, offerDate);
    }

    // Override toString for easy debugging
    @Override
    public String toString() {
        return "TTourPackage{" +
                "vacationName='" + vacationName + '\'' +
                ", offerDate=" + offerDate +
                ", terminationDate=" + terminationDate +
                ", operators=" + operators +
                '}';
    }
}

```

3.  TourOperator

```java
public enum TourOperator {
    OPERATOR_A,
    OPERATOR_B
}
```

4.  TourPackageTest

```java
class TourPackageTest {

	private TourManager tourManager;

    @BeforeEach
    void setUp() {
        tourManager = new TourManager();
    }

    @Test
    void testAddFirstPackage() {
        // First time adding a package from OperatorA
        TTourPackage packageA = new TTourPackage("Summer Vacation", LocalDate.of(2024, 7, 1), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA);

        // Verify that the package is added and not terminated
        Optional<TTourPackage> activePackage = tourManager.getVacations().stream().findFirst();
        assertTrue(activePackage.isPresent());
        assertEquals("Summer Vacation", activePackage.get().getVacationName());
        assertNull(activePackage.get().getTerminationDate());
    }

    @Test
    void testAddSameVacationFromDifferentOperator() {
        // Step 1: Add a package from OperatorA
        TTourPackage packageA = new TTourPackage("Beach Holiday", LocalDate.of(2024, 1, 2), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA);

        // Step 2: Add a package from OperatorB with the same vacation
        TTourPackage packageB = new TTourPackage("Beach Holiday", LocalDate.of(2024, 1, 3), TourOperator.OPERATOR_B);
        tourManager.addPackage(packageB);

        // Step 3: Verify that the package from OperatorB is active
        Optional<TTourPackage> beachHolidayPackageB = tourManager.getVacations().stream()
                .filter(pkg -> pkg.getVacationName().equals("Beach Holiday") && pkg.getOperators().contains(TourOperator.OPERATOR_B))
                .findFirst();

        assertTrue(beachHolidayPackageB.isPresent());
        assertNull(beachHolidayPackageB.get().getTerminationDate());  // Package from OperatorB should be active

        // Check that the package from OperatorA is terminated
        Optional<TTourPackage> beachHolidayPackageA = tourManager.getVacations().stream()
                .filter(pkg -> pkg.getVacationName().equals("Beach Holiday") && pkg.getOperators().contains(TourOperator.OPERATOR_A))
                .findFirst();

        assertTrue(beachHolidayPackageA.isPresent());
        assertNotNull(beachHolidayPackageA.get().getTerminationDate());  // Package from OperatorA should be terminated
    }


    @Test
    void testOperatorBReplacesOperatorA() {
        // Add a package from OperatorA
        TTourPackage packageA = new TTourPackage("Beach Vacation", LocalDate.of(2024, 6, 1), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA);

        // Add a different package from OperatorB
        TTourPackage packageB = new TTourPackage("Mountain Retreat", LocalDate.of(2024, 6, 10), TourOperator.OPERATOR_B);
        tourManager.addPackage(packageB);

        // Verify that the package from Operator A is terminated and B is active
        Optional<TTourPackage> activePackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() == null).findFirst();
        assertTrue(activePackage.isPresent());
        assertEquals("Mountain Retreat", activePackage.get().getVacationName());
        assertTrue(activePackage.get().getOperators().contains(TourOperator.OPERATOR_B));

        // Check that the previous package from Operator A is terminated
        Optional<TTourPackage> terminatedPackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() != null).findFirst();
        assertTrue(terminatedPackage.isPresent());
        assertEquals("Beach Vacation", terminatedPackage.get().getVacationName());
    }

    @Test
    void testOperatorAReplacesOperatorA() {
        // Add a package from OperatorA
        TTourPackage packageA = new TTourPackage("Cruise Vacation", LocalDate.of(2024, 3, 1), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA);

        // Add a different package from OperatorA with a later offer date
        TTourPackage packageA2 = new TTourPackage("Safari Adventure", LocalDate.of(2024, 4, 1), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA2);

        // Verify that the latest package from Operator A is active
        Optional<TTourPackage> activePackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() == null).findFirst();
        assertTrue(activePackage.isPresent());
        assertEquals("Safari Adventure", activePackage.get().getVacationName());

        // Verify that the older package from Operator A is terminated
        Optional<TTourPackage> terminatedPackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() != null).findFirst();
        assertTrue(terminatedPackage.isPresent());
        assertEquals("Cruise Vacation", terminatedPackage.get().getVacationName());
    }

    @Test
    void testOperatorAAddedWhenOperatorBIsActive() {
        // Add a package from OperatorB
        TTourPackage packageB = new TTourPackage("City Tour", LocalDate.of(2024, 2, 1), TourOperator.OPERATOR_B);
        tourManager.addPackage(packageB);

        // Add a different package from OperatorA
        TTourPackage packageA = new TTourPackage("Desert Safari", LocalDate.of(2024, 3, 15), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA);

        // Verify that the package from OperatorB is still active and OperatorA package is terminated
        Optional<TTourPackage> activePackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() == null).findFirst();
        assertTrue(activePackage.isPresent());
        assertEquals("City Tour", activePackage.get().getVacationName());
        assertTrue(activePackage.get().getOperators().contains(TourOperator.OPERATOR_B));

        // Check that the package from Operator A is terminated
        Optional<TTourPackage> terminatedPackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() != null).findFirst();
        assertTrue(terminatedPackage.isPresent());
        assertEquals("Desert Safari", terminatedPackage.get().getVacationName());
    }

    @Test
    void testSameOperatorWithDifferentPackage() {
        // Add a package from OperatorA
        TTourPackage packageA1 = new TTourPackage("Beach Holiday", LocalDate.of(2024, 1, 1), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA1);

        // Add another package from OperatorA (different vacation)
        TTourPackage packageA2 = new TTourPackage("Mountain Trip", LocalDate.of(2024, 1, 2), TourOperator.OPERATOR_A);
        tourManager.addPackage(packageA2);

        // Assert that both packages are in the collection, but the older one is terminated
        Optional<TTourPackage> beachHolidayPackage = tourManager.getVacations().stream()
                .filter(pkg -> pkg.getVacationName().equals("Beach Holiday"))
                .findFirst();

        Optional<TTourPackage> mountainTripPackage = tourManager.getVacations().stream()
                .filter(pkg -> pkg.getVacationName().equals("Mountain Trip"))
                .findFirst();

        assertTrue(beachHolidayPackage.isPresent());
        assertNotNull(beachHolidayPackage.get().getTerminationDate());  // The Beach Holiday package should be terminated

        assertTrue(mountainTripPackage.isPresent());
        assertNull(mountainTripPackage.get().getTerminationDate());  // The Mountain Trip package should be active
    }


	@Test
	void testOperatorAAndOperatorBWithNewOfferFromOperatorA() {
	    // Add a package from OperatorA
	    TTourPackage packageA = new TTourPackage("City Tour", LocalDate.of(2024, 3, 1), TourOperator.OPERATOR_A);
	    tourManager.addPackage(packageA);

	    // Add a package from OperatorB
	    TTourPackage packageB = new TTourPackage("Beach Retreat", LocalDate.of(2024, 3, 10), TourOperator.OPERATOR_B);
	    tourManager.addPackage(packageB);

	    // Add another package from OperatorA
	    TTourPackage packageA2 = new TTourPackage("Forest Trek", LocalDate.of(2024, 4, 1), TourOperator.OPERATOR_A);
	    tourManager.addPackage(packageA2);

	    // Verify that both OperatorA packages are terminated, and OperatorB is still active
	    Optional<TTourPackage> activePackage = tourManager.getVacations().stream().filter(pkg -> pkg.getTerminationDate() == null).findFirst();
	    assertTrue(activePackage.isPresent());
	    assertEquals("Beach Retreat", activePackage.get().getVacationName());
	    assertTrue(activePackage.get().getOperators().contains(TourOperator.OPERATOR_B));

	    // Verify that both OperatorA packages are terminated
	    long terminatedPackagesA = tourManager.getVacations().stream()
	            .filter(pkg -> pkg.getOperators().contains(TourOperator.OPERATOR_A) && pkg.getTerminationDate() != null)
	            .count();
	    assertEquals(2, terminatedPackagesA);
	}

	@Test
	void testSameOperatorWithOlderOfferDate() {
	    // Step 1: Add a package with a newer offer date
	    TTourPackage newPackage = new TTourPackage("Mountain Getaway", LocalDate.of(2024, 2, 15), TourOperator.OPERATOR_A);
	    tourManager.addPackage(newPackage);

	    // Step 2: Add a package with the same operator but an older offer date
	    TTourPackage olderPackage = new TTourPackage("Mountain Getaway", LocalDate.of(2024, 1, 5), TourOperator.OPERATOR_A);
	    tourManager.addPackage(olderPackage);

	    // Step 3: Verify that the package with the newer offer date is still active
	    TreeSet<TTourPackage> vacations = tourManager.getVacations();
	    Optional<TTourPackage> activePackage = vacations.stream()
	            .filter(pkg -> pkg.getVacationName().equals("Mountain Getaway") && pkg.getTerminationDate() == null && pkg.getOperators().contains(TourOperator.OPERATOR_A))
	            .findFirst();

	    assertTrue(activePackage.isPresent());
	    assertEquals(LocalDate.of(2024, 2, 15), activePackage.get().getOfferDate());
	    assertNull(activePackage.get().getTerminationDate());  // Package should be active

	    // Step 4: Verify that the older package is terminated
	    Optional<TTourPackage> terminatedPackage = tourManager.getVacations().stream()
	            .filter(pkg -> pkg.getVacationName().equals("Mountain Getaway") && pkg.getOfferDate().equals(LocalDate.of(2024, 1, 5)))
	            .findFirst();

	    assertTrue(terminatedPackage.isPresent());
	    assertNotNull(terminatedPackage.get().getTerminationDate());  // Older package should be terminated
	}

}
```