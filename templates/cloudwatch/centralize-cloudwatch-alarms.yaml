# src: https://aws.amazon.com/blogs/mt/how-to-centralize-cloudwatch-alarms-with-amazon-eventbridge-and-aws-cloudformation/

---
AWSTemplateFormatVersion: '2010-09-09'
Description: |
  Centralize Amazon CloudWatch alarms in a multi-account environment with Amazon EventBridge.
  **WARNING** This template creates an Amazon CloudWatch Log group and uses Cross-account/Cross-region
  events with Amazon EventBridge. You will be billed for the AWS resources used if you create
  a stack from this template.

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: Account Details
        Parameters:
        - ReceiverAccountIDParam
        - BusParam
        - OrganizationIDParam

      - Label:
          default: Centralize Regions
        Parameters:
          - CentralizationParam
          - CentralizationRegionParam

      - Label:
          default: (Optional) Add an Amazon CloudWatch Log group Target
        Parameters:
          - CreateTargetParam
          - CloudWatchLogGroupParam

Parameters:
  ReceiverAccountIDParam:
    Description: The accountID for the Monitoring Account.
    Type: String
    AllowedPattern: ^[0-9]{12}$
    MinLength: 1
    MaxLength: 12

  BusParam:
    Description: The name of the custom Bus in the Monitoring Account.
    Type: String
    MinLength: 1
    MaxLength: 256

  OrganizationIDParam:
    Type: String
    AllowedPattern: ^o-[a-z0-9]+
    Description: The OrgID to allow all members of your AWS Organizations to use the PutEvents.

  CentralizationParam:
    Type: String
    Default: 'No'
    AllowedValues:
      - 'Yes'
      - 'No'
    Description: Select 'Yes' if you would like to centralize the events on the receiver account.

  CentralizationRegionParam:
    Type: String
    Default: ''
    Description: "Enter the region to centralize the events on the receiver account. For example: US East (Ohio), type us-east-2. Leave this as blank if the above parameter is selected as 'NO'"

  CreateTargetParam:
    Type: String
    Default: 'No'
    AllowedValues:
      - 'Yes'
      - 'No'
    Description: Select 'Yes' if you would like to create a target.

  CloudWatchLogGroupParam:
    Type: String
    Default: /aws/events/EB-Test

