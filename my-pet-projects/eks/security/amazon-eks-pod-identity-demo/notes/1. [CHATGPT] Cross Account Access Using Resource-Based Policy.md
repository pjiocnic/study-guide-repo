<h1>[CHATGPT] Cross Account Access Using Resource-Based Policy</h1>

In this example, we will allow an IAM role in Account B to access an S3 bucket in Account A using a resource-based policy on the S3 bucket.

# Step 1: Create an IAM Role in Account B

1. Sign in to the AWS Management Console for Account B.
2. Create an IAM Role that the users in Account B will assume to access the S3 bucket in Account A.

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::AccountB-ID:role/AccountBRoleName"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}

3. Attach the necessary permissions to the role (e.g., AmazonS3ReadOnlyAccess).

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::example-bucket",
                "arn:aws:s3:::example-bucket/*"
            ]
        }
    ]
}
```

# Step 2: Create a Resource-Based Policy on the S3 Bucket in Account A

1. Sign in to the AWS Management Console for Account A.
2. Navigate to the S3 bucket that you want to grant access to.
3. Add a bucket policy that grants access to the IAM role in Account B.

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::AccountB-ID:role/AccountBRoleName"
            },
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::example-bucket",
                "arn:aws:s3:::example-bucket/*"
            ]
        }
    ]
}
```

# Step 3: Assume the Role in Account B and Access the S3 Bucket in Account A

1. Use the AWS CLI or SDK to assume the role in Account B and get temporary credentials.

```sh
aws sts assume-role --role-arn arn:aws:iam::AccountB-ID:role/AccountBRoleName --role-session-name S3AccessSession
```

2. Use the temporary credentials to access the S3 bucket in Account A.

```sh
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...
export AWS_SESSION_TOKEN=...

aws s3 ls s3://example-bucket
```

# Detailed Breakdown of Each Step

# Step 1: Create an IAM Role in Account B

1. Sign in to Account B.

2. Create a new IAM Role:

* Go to the IAM service and create a new role.
* Select "Another AWS account" as the type of trusted entity.
* Enter the Account ID of Account A.
* Attach a policy to allow the role to access S3. For example, attach AmazonS3ReadOnlyAccess.

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::example-bucket",
                "arn:aws:s3:::example-bucket/*"
            ]
        }
    ]
}
```

# Step 2: Create a Resource-Based Policy on the S3 Bucket in Account A

1. Sign in to Account A.
2. Go to S3 and select the bucket (example-bucket).
3. Add the following bucket policy to allow the role from Account B to access the bucket.

```json

{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::AccountB-ID:role/AccountBRoleName"
            },
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::example-bucket",
                "arn:aws:s3:::example-bucket/*"
            ]
        }
    ]
}
```

# Step 3: Assume the Role in Account B and Access the S3 Bucket in Account A

1. Use the AWS CLI or SDK to assume the role.

```sh
aws sts assume-role --role-arn arn:aws:iam::AccountB-ID:role/AccountBRoleName --role-session-name S3AccessSession
```

This command will return temporary security credentials (Access Key ID, Secret Access Key, and Session Token).

2. Set environment variables with the temporary credentials.

```sh
export AWS_ACCESS_KEY_ID=your-access-key-id
export AWS_SECRET_ACCESS_KEY=your-secret-access-key
export AWS_SESSION_TOKEN=your-session-token
```

3. Use the temporary credentials to access the S3 bucket.

```sh
aws s3 ls s3://example-bucket
```

## Summary

1. Account A has an S3 bucket and grants access to an IAM role from Account B via a bucket policy.
2. Account B creates an IAM role with permissions to assume that role and access S3.
3. Users in Account B assume the role, obtain temporary credentials, and use those credentials to access the S3 bucket in Account A.